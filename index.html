// app.js
const express = require("express");
const session = require("express-session");
const path = require("path");

const app = express();

// Session
app.use(
    session({
        secret: "madrid-secret",
        resave: false,
        saveUninitialized: true
    })
);

app.use(express.urlencoded({ extended: true }));

// ---- DATA ----
const club = {
    name: "Real Madrid CF",
    founded: 1902,
    stadium: "Santiago Bernabéu",
    manager: "Carlo Ancelotti",
    website: "https://www.realmadrid.com",
    description:
        "Real Madrid Club de Fútbol is a professional football club based in Madrid, Spain. Known for its rich history, record-breaking achievements and a galaxy of the world's top players."
};

const achievements = {
    "La Liga titles": 35,
    "UEFA Champions League": 14,
    "Copa del Rey": 19,
    "FIFA Club World Cup": 5
};

const squad = [
    { number: 1, name: "Thibaut Courtois", position: "Goalkeeper" },
    { number: 4, name: "Éder Militão", position: "Defender" },
    { number: 5, name: "Ms Rasheedat", position: "Defender" },
    { number: 8, name: "Femi Mastatuono", position: "Midfielder" },
    { number: 9, name: "Brahim Díaz", position: "Forward" },
    { number: 11, name: "Rodrygo", position: "Forward" },
    { number: 14, name: "Kylian Mbappe", position: "Forward" }
];

const recent_matches = [
    { date: "2025-11-02", opponent: "Atlético Madrid", score: "2 - 1", competition: "La Liga" },
    { date: "2025-10-26", opponent: "Liverpool", score: "1 - 1", competition: "UEFA Champions League" },
    { date: "2025-10-19", opponent: "Valencia", score: "3 - 0", competition: "La Liga" }
];

// ---- ROUTE ----
app.get("/", (req, res) => {
    if (!req.session.messages) req.session.messages = [];

    res.send(`
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>${club.name} — Fan Site</title>
<style>
:root{font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;}
body{margin:0;background:#f7f7f8;color:#111}
header{background:#002663;color:#fff;padding:24px 16px;display:flex;align-items:center;justify-content:space-between}
.logo{display:flex;align-items:center;gap:12px}
.logo .crest{width:56px;height:56px;border-radius:8px;background:linear-gradient(135deg,#fff,#eee);display:flex;align-items:center;justify-content:center;color:#002663;font-weight:700}
nav a{color:#fff;margin-left:16px;text-decoration:none;font-weight:600}
.container{max-width:1100px;margin:28px auto;padding:0 16px}
.hero{background:#fff;border-radius:12px;padding:20px;display:flex;gap:20px;align-items:center;box-shadow:0 6px 18px rgba(16,24,40,.06)}
.hero .text h1{margin:0;font-size:28px}
.grid{display:grid;grid-template-columns:2fr 1fr;gap:20px;margin-top:20px}
.card{background:#fff;border-radius:10px;padding:16px;box-shadow:0 6px 18px rgba(16,24,40,.04)}
ul.clean{list-style:none;padding:0;margin:0}
table{width:100%;border-collapse:collapse}
table td,table th{padding:8px;border-bottom:1px solid #eee;text-align:left}
footer{padding:24px;text-align:center;color:#666}
.squad-list li{padding:8px 0;border-bottom:1px dashed #eee}
.badge{display:inline-block;padding:6px 8px;border-radius:999px;background:#fde047;font-weight:700}
@media(max-width:800px){.grid{grid-template-columns:1fr;}.hero{flex-direction:column;align-items:flex-start}}
</style>
</head>
<body>

<header>
    <div class="logo">
        <div class="crest">RM</div>
        <div>
            <div style="font-size:18px;font-weight:800">${club.name}</div>
            <div style="font-size:12px;opacity:.85">Founded ${club.founded} • ${club.stadium}</div>
        </div>
    </div>
    <nav>
        <a href="#club">Club</a>
        <a href="#squad">Squad</a>
        <a href="#matches">Matches</a>
        <a href="#contact">Contact</a>
    </nav>
</header>

<main class="container">

<section class="hero">
    <div class="text">
        <h1>Welcome to the fan-made Real Madrid page</h1>
        <p style="margin:8px 0 0;max-width:60ch">${club.description}</p>
        <p style="margin:12px 0 0"><a href="${club.website}" target="_blank">Official website</a></p>
    </div>
    <div style="margin-left:auto;text-align:right">
        <div class="badge">Latest: La Liga & Champions</div>
        <div style="margin-top:8px;font-size:13px;opacity:.9">Manager: ${club.manager}</div>
    </div>
</section>

<div class="grid">
<section class="card" id="club">
<h2>Club Info</h2>
<table>
<tr><th>Founded</th><td>${club.founded}</td></tr>
<tr><th>Stadium</th><td>${club.stadium}</td></tr>
<tr><th>Manager</th><td>${club.manager}</td></tr>
<tr><th>Notable trophies</th><td>
    <ul class="clean">
        ${Object.keys(achievements)
            .map(k => `<li>${k} — <strong>${achievements[k]}</strong></li>`)
            .join("")}
    </ul>
</td></tr>
</table>

<h3 style="margin-top:18px">About the club</h3>
<p style="line-height:1.6">Real Madrid has produced many of the world's best players. This fan page shows recent results and current squad.</p>
</section>

<aside class="card" id="squad">
<h3>First Team Squad</h3>
<ul class="clean squad-list">
    ${squad
        .map(
            p =>
                `<li>#${p.number} — ${p.name} <span style='float:right;font-size:12px;opacity:.7'>${p.position}</span></li>`
        )
        .join("")}
</ul>
<h4 style="margin-top:14px">Quick facts</h4>
<p style="font-size:13px;opacity:.9">Ticket info changes frequently — check official site.</p>
</aside>
</div>

<div class="grid" style="margin-top:18px">
<section class="card" id="matches">
<h2>Recent Matches</h2>
<table>
<thead>
<tr><th>Date</th><th>Opponent</th><th>Score</th><th>Competition</th></tr>
</thead>
<tbody>
${recent_matches
    .map(
        m =>
            `<tr><td>${m.date}</td><td>${m.opponent}</td><td>${m.score}</td><td>${m.competition}</td></tr>`
    )
    .join("")}
</tbody>
</table>

<h3 style="margin-top:14px">Match highlights</h3>
<p>Add short highlights or embed videos later.</p>
</section>

<aside class="card" id="contact">
<h3>Contact / Fan messages</h3>

${req.session.justSent ? `
<div style="padding:10px;border-radius:8px;background:#ecfdf5;color:#065f46;margin-bottom:12px">
Thanks! Your message was saved for this session.
</div>
` : ""}

<form method="post" style="display:flex;flex-direction:column;gap:8px">
    <input name="name" placeholder="Your name" required style="padding:8px;border-radius:6px;border:1px solid #ddd">
    <input type="email" name="email" placeholder="Email" required style="padding:8px;border-radius:6px;border:1px solid #ddd">
    <textarea name="message" placeholder="Message to the fans" rows="4" required style="padding:8px;border-radius:6px;border:1px solid #ddd"></textarea>
    <button type="submit" style="padding:10px;border-radius:8px;border:none;background:#002663;color:#fff;font-weight:700">
        Send message
    </button>
</form>

${req.session.messages.length > 0 ? `
<h4 style="margin-top:14px">Messages (session)</h4>
<ul class="clean" style="max-height:180px;overflow:auto">
${req.session.messages
    .slice()
    .reverse()
    .map(
        msg =>
            `<li style="padding:8px;border-bottom:1px solid #f1f1f1"><strong>${msg.name}</strong>
             <small style="opacity:.7">@ ${msg.time}</small>
             <div style="margin-top:6px;font-size:14px">${msg.message}</div></li>`
    )
    .join("")}
</ul>` : ""}
</aside>
</div>

<section class="card" style="margin-top:18px">
<h2>Gallery & Stadium</h2>
<p>Add images for the crest, kit, or stadium later.</p>
<div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:12px">
    <div style="width:220px;height:120px;border-radius:8px;background:#e9eef7;display:flex;align-items:center;justify-content:center">Stadium</div>
    <div style="width:220px;height:120px;border-radius:8px;background:#ffeef0;display:flex;align-items:center;justify-content:center">Team kit</div>
    <div style="width:220px;height:120px;border-radius:8px;background:#eafaea;display:flex;align-items:center;justify-content:center">Crest</div>
</div>
</section>

</main>

<footer>
<div class="container">
<p>This is a fan-made site and not affiliated with Real Madrid CF.</p>
<p style="margin-top:8px">© ${new Date().getFullYear()} Fan Site</p>
</div>
</footer>

</body>
</html>
    `);

    req.session.justSent = false;
});

// POST: contact messages
app.post("/", (req, res) => {
    const { name, email, message } = req.body;

    if (!req.session.messages) req.session.messages = [];

    if (name && email && message) {
        req.session.messages.push({
            name,
            email,
            message,
            time: new Date().toISOString().slice(0, 19).replace("T", " ")
        });
        req.session.justSent = true;
    }

    res.redirect("/");
});

// ---- START SERVER ----
app.listen(3000, () => console.log("Server running on http://localhost:3000"));

